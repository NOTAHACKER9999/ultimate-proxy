<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Proxy Browser</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="browserBar">
  <button id="undoBtn">⟲</button>
  <button id="redoBtn">⟳</button>
  <input type="text" id="urlInput" placeholder="Search or enter URL"/>
  <button id="goBtn">Go</button>
</div>

<div id="tabsContainer"></div>

<script>
const tabsContainer = document.getElementById('tabsContainer');
const urlInput = document.getElementById('urlInput');
const goBtn = document.getElementById('goBtn');
const undoBtn = document.getElementById('undoBtn');
const redoBtn = document.getElementById('redoBtn');

let tabs = [];
let historyStack = [];
let redoStack = [];
let currentTab = null;

function updateBrowserBar(url) {
  urlInput.value = url;
}

function createTab(url) {
  const iframe = document.createElement('iframe');
  iframe.src = '/proxy/' + encodeURIComponent(url);
  iframe.className = 'tabFrame';
  tabsContainer.innerHTML = '';
  tabsContainer.appendChild(iframe);
  tabs = [iframe];
  currentTab = 0;
  historyStack = [url];
  redoStack = [];
  updateBrowserBar(url);
}

// Navigate current tab
function navigate(input) {
  let url;
  if(input.startsWith('http')) url = input;
  else url = 'https://duckduckgo.com/?q=' + encodeURIComponent(input) + '&ia=web';

  tabs[currentTab].src = '/proxy/' + encodeURIComponent(url);
  historyStack.push(url);
  redoStack = [];
  updateBrowserBar(url);
}

// Undo / Redo
undoBtn.addEventListener('click', () => {
  if(historyStack.length > 1) {
    const last = historyStack.pop();
    redoStack.push(last);
    const prev = historyStack[historyStack.length-1];
    tabs[currentTab].src = '/proxy/' + encodeURIComponent(prev);
    updateBrowserBar(prev);
  }
});

redoBtn.addEventListener('click', () => {
  if(redoStack.length > 0) {
    const next = redoStack.pop();
    historyStack.push(next);
    tabs[currentTab].src = '/proxy/' + encodeURIComponent(next);
    updateBrowserBar(next);
  }
});

// Event listeners
goBtn.addEventListener('click', () => navigate(urlInput.value));
urlInput.addEventListener('keypress', e => { if(e.key === 'Enter') navigate(urlInput.value); });

// Auto-load DuckDuckGo
createTab('https://duckduckgo.com/');
</script>
</body>
</html>
