<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Proxy Browser</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div id="browserBar">
  <button id="newTabBtn">+ Tab</button>
  <input type="text" id="urlInput" placeholder="Enter URL or search" />
  <button id="goBtn">Go</button>
</div>

<div id="tabsContainer"></div>

<script>
const tabsContainer = document.getElementById('tabsContainer');
const urlInput = document.getElementById('urlInput');
const goBtn = document.getElementById('goBtn');
const newTabBtn = document.getElementById('newTabBtn');

let tabs = [];
let currentTab = null;

function updateBrowserBar(url) {
  // Show only the target URL, hide proxy prefix
  urlInput.value = url;
}

// Create a new tab
function createTab(targetUrl) {
  const iframe = document.createElement('iframe');
  iframe.src = '/proxy/' + encodeURIComponent(targetUrl);
  iframe.className = 'tabFrame';
  tabsContainer.appendChild(iframe);
  tabs.push(iframe);

  switchTab(tabs.length - 1);
  updateBrowserBar(targetUrl);
}

// Switch to a tab
function switchTab(index) {
  tabs.forEach((tab, i) => {
    tab.style.display = i === index ? 'block' : 'none';
  });
  currentTab = index;

  // Update browser bar to show current tab's URL
  if(tabs[currentTab]) {
    const src = tabs[currentTab].src;
    const decoded = decodeURIComponent(src.split('/proxy/')[1] || '');
    updateBrowserBar(decoded);
  }
}

// Navigate current tab
function navigate(input) {
  let url;
  if(input.startsWith('http')) {
    url = input;
  } else {
    url = 'https://duckduckgo.com/?q=' + encodeURIComponent(input) + '&ia=web';
  }
  tabs[currentTab].src = '/proxy/' + encodeURIComponent(url);
  updateBrowserBar(url);
}

// Event listeners
goBtn.addEventListener('click', () => navigate(urlInput.value));
urlInput.addEventListener('keypress', e => { if(e.key === 'Enter') navigate(urlInput.value); });
newTabBtn.addEventListener('click', () => createTab('https://duckduckgo.com/'));

// Auto-load DuckDuckGo on start
createTab('https://duckduckgo.com/');
</script>
</body>
</html>
